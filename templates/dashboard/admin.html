@dashboard.route('/admin')
@login_required
@admin_required
def admin():
    """Dashboard do administrador - Versão Emergência"""
    
    # Estatísticas básicas e seguras
    stats = {
        'total_users': 0,
        'pending_users': 0,
        'admins': 0,
        'moderators': 0,
        'students': 0,
        'total_quizzes': 0,
        'active_quizzes': 0,
        'archived_quizzes': 0,
        'deleted_quizzes': 0,
        'total_questions': 0,
        'total_quiz_plays': 0
    }
    
    # Tentar buscar dados básicos
    try:
        stats['total_users'] = User.query.count()
        stats['pending_users'] = User.query.filter_by(is_approved=False).count()
        stats['admins'] = User.query.filter_by(user_type='admin').count()
        stats['moderators'] = User.query.filter_by(user_type='moderator').count()
        stats['students'] = User.query.filter_by(user_type='student').count()
        stats['total_quizzes'] = Quiz.query.count()
        stats['total_questions'] = Question.query.count()
        stats['total_quiz_plays'] = QuizResult.query.count()
    except Exception as e:
        current_app.logger.error(f"Erro no dashboard admin: {e}")
    
    # Listas vazias para não quebrar o template
    recent_users = []
    popular_quizzes = []
    pending_users = []
    recent_activity = []
    recent_stats = {'new_users': 0, 'new_quizzes': 0, 'quiz_plays': 0}
    
    return render_template('dashboard/admin.html',
                           stats=stats,
                           recent_users=recent_users,
                           popular_quizzes=popular_quizzes,
                           pending_users=pending_users,
                           recent_activity=recent_activity,
                           recent_stats=recent_stats)
